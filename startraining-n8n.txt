============================================================
STARTRAINING N8N AUTOMATION - PROJECT STATUS
============================================================
Date: January 2, 2026 (Updated)
============================================================

GOAL
----
Automate the StarTraining workout publishing pipeline:
1. Detect new Word file uploaded to Google Drive
2. Run Python pipeline (Agents Aâ†’Bâ†’Câ†’D) to extract & format workout data
3. Create Canva design from template using the CSV data
4. Send the design image via WhatsApp

============================================================

WORKFLOW OVERVIEW
-----------------
Node 1:  Google Drive Trigger    â†’ Watch for new .docx files
Node 2:  Code                    â†’ Extract date & label from filename
Node 3:  HTTP Request            â†’ Call webhook_server.py to run pipeline
Node 4:  IF                      â†’ Check if pipeline succeeded
Node 5:  HTTP Request            â†’ Canva: Create design from template
Node 6:  Wait                    â†’ Wait for Canva to render
Node 7:  HTTP Request            â†’ Canva: Export design as PNG
Node 8:  Wait                    â†’ Wait for export
Node 9:  HTTP Request            â†’ Canva: Get export URL
Node 10: HTTP Request            â†’ WhatsApp: Send image

============================================================

DIRECTORY STRUCTURE
-------------------
Keep n8n and Python pipeline SEPARATE:

~/
â”œâ”€â”€ startraining-ai-pipeline/    â† Python scripts (your repo)
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ agentA.py
â”‚   â”‚   â”œâ”€â”€ agentB.py            â† Fixed: buffered CSV writing
â”‚   â”‚   â”œâ”€â”€ agentC.py
â”‚   â”‚   â””â”€â”€ agentD.py
â”‚   â”œâ”€â”€ webhook_server.py
â”‚   â”œâ”€â”€ run_pipeline.py
â”‚   â”œâ”€â”€ run_all_pipeline.py
â”‚   â”œâ”€â”€ config.py
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ .n8n/                        â† n8n data (auto-created by Docker)
â”‚   â”œâ”€â”€ database.sqlite          â† Workflows, credentials
â”‚   â””â”€â”€ config                   â† n8n settings
â”‚
â””â”€â”€ Google Drive/
    â””â”€â”€ Blackboard/
        â”œâ”€â”€ Raw/                 â† Upload .docx files here
        â”œâ”€â”€ AgentA/              â† AgentA output
        â”œâ”€â”€ AgentB/              â† AgentB output
        â”œâ”€â”€ AgentC/              â† AgentC output (pivoted)
        â””â”€â”€ AgentD/              â† AgentD output (for Canva)

============================================================

COMPLETED âœ…
------------
[âœ…] Python pipeline working locally (Agents A, B, C, D)
[âœ…] Webhook server created (webhook_server.py)
[âœ…] Google Cloud project created ("n8n-connector")
[âœ…] Google Drive API enabled
[âœ…] OAuth 2.0 credentials created (Web application)
[âœ…] Test user added to OAuth consent screen
[âœ…] Docker installed on Mac
[âœ…] n8n running locally (http://127.0.0.1:5678)
[âœ…] Webhook server running on port 5001
[âœ…] n8n workflow imported (StarTraining Pipeline)
[âœ…] Redirect URI added to Google Cloud Console
[âœ…] Node 1: Google Drive trigger connected (folder: 1ggqu326-4x_YghpkjTsrg9_AVKpr92Qt)
[âœ…] Node 3: Webhook URL configured (http://host.docker.internal:5001/run-single)
[âœ…] Pipeline test run successful (fixed agentB.py timeout issue)
[âœ…] Canva Developer Integration created
[âœ…] Canva Client ID and Client Secret obtained
[âœ…] Canva OAuth connected (PKCE + 127.0.0.1 fix applied)

============================================================

IN PROGRESS ğŸ”„
--------------
[ğŸ”„] Node 5: Get Canva template ID for workout design
     â†’ Need to create/configure template in Canva
     â†’ Get template ID from URL

============================================================

TODO âŒ
-------
[âŒ] Node 5: Configure Canva template ID in workflow
[âŒ] Node 10: Set up WhatsApp credentials
[âŒ] Node 10: Add recipient phone number
[âŒ] Test complete workflow end-to-end
[âŒ] (Optional) Set up ngrok for external access

============================================================

CREDENTIALS STATUS
------------------

1. GOOGLE DRIVE âœ… CONNECTED
   - Client ID: 947653681876-b288b3b0m2ang0ucdlkrtqdjt2447sgi.apps.googleusercontent.com
   - Client Secret: [saved in n8n]
   - Redirect URI: http://127.0.0.1:5678/rest/oauth2-credential/callback

2. CANVA âœ… CONNECTED
   - Integration created at: https://www.canva.dev
   - Client ID: [saved in n8n]
   - Client Secret: [saved in n8n]
   - Redirect URI: http://127.0.0.1:5678/rest/oauth2-credential/callback
   - Grant Type: PKCE (required by Canva)
   - Scopes: asset:read design:content:read design:content:write brandtemplate:content:read

   CRITICAL FIX APPLIED:
   - Must use 127.0.0.1 (not localhost) - Canva rejects localhost
   - Must restart n8n with: -e WEBHOOK_URL=http://127.0.0.1:5678/
   - Must use PKCE grant type (not Authorization Code)

3. WHATSAPP (not started)
   - Get from: https://developers.facebook.com
   - Need: Phone Number ID
   - Need: Access Token
   - Recipient phone number (format: 34612345678)

============================================================

COMMANDS REFERENCE
------------------

Start n8n (Docker):
  docker start n8n
  # Then open http://localhost:5678

Stop n8n:
  docker stop n8n

Start webhook server:
  cd ~/GitHub/startraining-ai-pipeline
  source .venv/bin/activate
  PORT=5001 python webhook_server.py

Test webhook:
  curl http://localhost:5001/health

============================================================

URLS & PATHS
------------
n8n Local:           http://localhost:5678
Webhook Server:      http://localhost:5001
Google Cloud:        https://console.cloud.google.com
Canva Developers:    https://www.canva.dev
Meta Developers:     https://developers.facebook.com

============================================================

NEXT STEP - GET CANVA TEMPLATE ID
----------------------------------

You need a Canva Brand Template ID to autofill workout data.

1. Open Canva: https://www.canva.com

2. Create or open your workout template design

3. IMPORTANT: Save as Brand Template (requires Canva Pro/Team)
   â†’ Click "Share" â†’ "More" â†’ "Brand template"
   â†’ Or: File â†’ Save as brand template

4. Get the Template ID from the URL:
   https://www.canva.com/design/DAGxxxxxxxx.../edit
                              â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘
                              This is your template ID

5. In n8n, update Node 5 (Create Canva Design):
   â†’ Edit the HTTP Request body
   â†’ Replace "REPLACE_WITH_YOUR_CANVA_TEMPLATE_ID" with your actual ID

Example template ID format: DAGcN8QVCgA (alphanumeric string)

============================================================

BUG FIXES APPLIED
-----------------

agentB.py - Fixed Google Drive sync timeout
  - Problem: Writing CSV row-by-row caused timeout with Google Drive sync
  - Solution: Buffer all rows in memory, write once at end
  - File: ~/GitHub/startraining-ai-pipeline/agents/agentB.py

============================================================
